From f3d3e66710959dbcf1819f713b0f3f50cefe1a6a Mon Sep 17 00:00:00 2001
From: Jan Hermann <dev@jan.hermann.name>
Date: Fri, 26 Nov 2021 11:49:53 +0100
Subject: [PATCH] remove nonstandard mpiexec flag

---
 .github/workflows/tests.yaml | 2 ++
 tests/CMakeLists.txt         | 2 +-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/.github/workflows/tests.yaml b/.github/workflows/tests.yaml
index 43b72fc..16b654d 100644
--- a/.github/workflows/tests.yaml
+++ b/.github/workflows/tests.yaml
@@ -25,6 +25,8 @@ jobs:
             python-version: 3.9
             mpi-nodes: 2
     runs-on: ${{ matrix.os }}
+    env:
+      MPIEXEC_EXTRA_FLAGS: --oversubscribe
     steps:
       - run: sudo apt-get install -yq --no-install-suggests --no-install-recommends gfortran libblas-dev liblapack-dev mpi-default-dev mpi-default-bin libscalapack-mpi-dev
         if: ${{ contains(matrix.os, 'ubuntu') }}
diff --git a/tests/CMakeLists.txt b/tests/CMakeLists.txt
index 09bd1ae..6e5fa53 100644
--- a/tests/CMakeLists.txt
+++ b/tests/CMakeLists.txt
@@ -24,7 +24,7 @@ if(ENABLE_SCALAPACK_MPI)
     if(NOT "${MPI_NODES}")
         set(MPI_NODES ${MPIEXEC_MAX_NUMPROCS})
     endif()
-    set(MPIEXEC_EXTRA_FLAGS "--oversubscribe")
+    set(MPIEXEC_EXTRA_FLAGS $ENV{MPIEXEC_EXTRA_FLAGS})
 endif()
 foreach(TEST ${TESTS})
     string(REPLACE "/" ";" TEST_APP_CASE ${TEST})
